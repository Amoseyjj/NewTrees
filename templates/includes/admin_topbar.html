<div class="topbar">
    <div>
        <p class="title">Dashboard</p>
    </div>
    <div class="leftside">
        <div class="topnav">
            <a href="/createReport" class="btn"><img src="{{ url_for('static', filename='add.png') }}" alt="Add"></a>
            <a href="/" class="btn"><img src="{{ url_for('static', filename='retrieve.png')}}" alt="Retrieve"></a>
        </div>
        <div class="search-container" style="display: flex; align-items: center; gap: 8px;">
            <div class="searchbar" contenteditable="true">
                Search for a Report
            </div>
            <button id="micButton" class="btn btn-outline-secondary" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                    <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<style>
.search-container {
    position: relative;
}

#micButton {
    transition: all 0.3s ease;
}

#micButton.listening {
    background-color: #dc3545;
    color: white;
    border-color: #dc3545;
}

.searchbar {
    min-width: 200px;
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    outline: none;
}

.searchbar:empty::before {
    content: 'Search for a Report';
    color: #999;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchBar = document.querySelector('.searchbar');
    const micButton = document.getElementById('micButton');
    const reportRows = document.querySelectorAll('.report-row');
    
    // Speech Recognition Setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        let isListening = false;

        micButton.addEventListener('click', () => {
            if (!isListening) {
                // Start listening
                recognition.start();
                isListening = true;
                micButton.classList.add('listening');
            } else {
                // Stop listening
                recognition.stop();
                isListening = false;
                micButton.classList.remove('listening');
            }
        });

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            searchBar.textContent = transcript;
            // Trigger the search
            const searchTerm = transcript.toLowerCase().trim();
            reportRows.forEach(row => {
                const title = row.getAttribute('data-title').toLowerCase();
                row.style.display = title.includes(searchTerm) ? '' : 'none';
            });
        };

        recognition.onend = () => {
            isListening = false;
            micButton.classList.remove('listening');
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error:', event.error);
            isListening = false;
            micButton.classList.remove('listening');
        };
    } else {
        micButton.style.display = 'none';
        console.log('Speech recognition not supported in this browser');
    }

    // Existing search functionality
    searchBar.addEventListener('click', function() {
        if (this.textContent === 'Search for a Report') {
            this.textContent = '';
        }
    });

    searchBar.addEventListener('input', function() {
        const searchTerm = this.textContent.toLowerCase().trim();
        reportRows.forEach(row => {
            const title = row.getAttribute('data-title').toLowerCase();
            row.style.display = title.includes(searchTerm) ? '' : 'none';
        });
    });

    // Clear search when clicking outside
    document.addEventListener('click', function(event) {
        if (!searchBar.contains(event.target) && searchBar.textContent.trim() === '') {
            searchBar.textContent = 'Search for a Report';
        }
    });
});
</script>